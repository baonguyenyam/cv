angular.module("baoNguyenApp",["common.fabric","common.fabric.utilities","common.fabric.constants","colorpicker.module"]).controller("nguyenCtrl",["$scope","Fabric","FabricConstants","Keypress",function($scope,Fabric,FabricConstants,Keypress){$scope.fabric={},$scope.FabricConstants=FabricConstants,$scope.saveImage=function(){$scope.fabric.download("nguyen_"+Math.random())},$scope.addImage=function(image){$scope.fabric.addImage(image)},$scope.addText=function(){$scope.fabric.setStroke(null),$scope.fabric.setStrokeWidth(1)},$scope.setImage=function(){$scope.fabric.setStroke(null),$scope.fabric.setStrokeWidth(0)},$scope.addRect=function(rc){$scope.fabric.addRect(rc),$("#sharpModal").modal("hide"),$scope.fabric.setStroke(null),$scope.fabric.setStrokeWidth(1)},$scope.addImageUpload=function(data){var obj=angular.fromJson(data);$scope.addImage(obj.filename)},$scope.selectCanvas=function(){$scope.canvasCopy={width:$scope.fabric.canvasOriginalWidth,height:$scope.fabric.canvasOriginalHeight}},$scope.setCanvasSize=function(){$scope.fabric.setCanvasSize($scope.canvasCopy.width,$scope.canvasCopy.height),$scope.fabric.setDirty(!0)},$scope.init=function(){$scope.fabric=new Fabric({JSONExportProperties:FabricConstants.JSONExportProperties,textDefaults:FabricConstants.textDefaults,shapeDefaults:FabricConstants.shapeDefaults,json:{}}),console.log("%cBAONGUYEN","font-size:100px;color:#ff451a;text-shadow:0 1px 0 #f73936,0 2px 0 #f73936 ,0 3px 0 #f73936 ,0 4px 0 #f73936 ,0 5px 0 #f73936 ,0 6px 1px rgba(0,0,0,.1),0 0 5px rgba(0,0,0,.1),0 1px 3px rgba(0,0,0,.3),0 3px 5px rgba(0,0,0,.2),0 5px 10px rgba(0,0,0,.25),0 10px 10px rgba(0,0,0,.2),0 20px 20px rgba(0,0,0,.15);"),console.log("%c BAONGUYEN %c - The best Web Solutions Provider","border-radius: 2px; padding: 3px; background: #ff451a; color: #FFF","color: #ff451a"),console.warn("BAONGUYEN warning: This is a browser feature intended for developers. If someone told you to copy and paste something here to enable a BAONGUYEN feature or 'hack' someone's account, it is a scam and will give them access to your BAONGUYEN account."),document.onkeyup=function(e){if((e=e||window.event).altKey&&e.ctrlKey&&e.shiftKey&&13==e.which)return alert("BAO NGUYEN - +(1) 682 203 1334\nEmail: baonguyenyam@gmail.com\nWeb: baonguyenyam.github.io"),!1}},$scope.$on("canvas:created",$scope.init),Keypress.onSave(function(){$scope.updatePage()}),$scope.caption="",$scope.fileUrl="",$scope.imageChange=function(inp){file=inp.files[0],fr=new FileReader,fr.onload=function(){(img=new Image).onload=imageLoaded,img.src=fr.result},fr.readAsDataURL(file);var img=null;function imageLoaded(){new fabric.Image(img);$scope.fabric.addImage(img.src)}},$scope.DrawingMode=["Pencil","Circle","Spray","Pattern"],$scope.csetDrawing="#f00",$scope.ysetDrawing="1",$scope.fsetDrawing="0",$scope.ymk="",$scope.sk="0",$scope.blisterPackTemplateSelected=$scope.DrawingMode[0],$scope.setPaint=function(){$scope.oPaint||$("#paintModal").modal("show"),$scope.oPaint=!$scope.oPaint,$scope.setFreeDrawingMode(!$scope.getFreeDrawingMode())},$scope.getFreeDrawingMode=function(){$scope.fabric.getFreeDrawingMode()},$scope.setFreeDrawingMode=function(e){e=!$scope.fabric.getFreeDrawingMode(),$scope.fabric.setFreeDrawingMode(e)},$scope.getDrawingMode=function(){$scope.fabric.getDrawingMode()},$scope.setDrawingMode=function(e){$scope.fabric.setDrawingMode(e)},$scope.setDrawingLineShadowWidth=function(e){$scope.fabric.setDrawingLineShadowWidth(e)},$scope.getDrawingLineShadowWidth=function(){$scope.fabric.getDrawingLineShadowWidth()},$scope.setDrawingLineColor=function(e){$scope.fabric.setDrawingLineColor(e)},$scope.getDrawingLineColor=function(){$scope.fabric.getDrawingLineColor()},$scope.setDrawingLineWidth=function(e){$scope.fabric.setDrawingLineWidth(e)},$scope.getDrawingLineWidth=function(){$scope.fabric.getDrawingLineWidth()},$scope.setStroke=function(e){$scope.fabric.setStroke(e)},$scope.getStroke=function(){$scope.fabric.getStroke()},$scope.setStrokeWidth=function(e){$scope.fabric.setStrokeWidth(e)},$scope.getStrokeWidth=function(){$scope.fabric.getStrokeWidth()}}]);var invokeImageChange=function(that){angular.element(that).scope().imageChange(that),angular.element(that).scope().$digest()};angular.module("common.fabric.window",[]).factory("FabricWindow",["$window",function($window){return $window.fabric}]),angular.module("common.fabric.utilities",[]).directive("parentClick",["$timeout",function($timeout){return{scope:{parentClick:"&"},link:function(scope,element){element.mousedown(function(){$timeout(function(){scope.parentClick()})}).children().mousedown(function(e){e.stopPropagation()})}}}]).factory("Keypress",[function(){var self={onSave:function(cb){$(document).keydown(function(event){if((event.ctrlKey||event.metaKey)&&83===event.which)return event.preventDefault(),cb(),!1})}};return self}]).filter("reverse",[function(){return function(items){if(items)return items.slice().reverse()}}]),angular.module("common.fabric.dirtyStatus",[]).service("FabricDirtyStatus",["$window",function($window){var self={dirty:!1};function checkSaveStatus(){if(self.isDirty())return"Oops! You have unsaved changes.\n\nPlease save before leaving so you don't lose any work."}return self.endListening=function(){$window.onbeforeunload=null,$window.onhashchange=null},self.startListening=function(){$window.onbeforeunload=checkSaveStatus,$window.onhashchange=checkSaveStatus},self.isDirty=function(){return self.dirty},self.setDirty=function(value){self.dirty=value},self}]),angular.module("common.fabric.directive",["common.fabric.canvas"]).directive("fabric",["$timeout","FabricCanvas","$window",function($timeout,FabricCanvas,$window){return{scope:{fabric:"="},controller:["$scope","$element",function($scope,$element){FabricCanvas.setElement($element),FabricCanvas.createCanvas(),$("body").on("click","canvas",function(){$scope.fabric.setUserHasClickedCanvas&&$scope.fabric.setUserHasClickedCanvas(!0)}),$scope.$watch("fabric.canvasBackgroundColor",function(newVal){$scope.fabric.setCanvasBackgroundColor&&$scope.fabric.setCanvasBackgroundColor(newVal)}),$scope.$watch("fabric.selectedObject.text",function(newVal){"string"==typeof newVal&&($scope.fabric.setText(newVal),$scope.fabric.render())}),$scope.$watch("fabric.selectedObject.fontSize",function(newVal){"string"!=typeof newVal&&"number"!=typeof newVal||($scope.fabric.setFontSize(newVal),$scope.fabric.render())}),$scope.$watch("fabric.selectedObject.lineHeight",function(newVal){"string"!=typeof newVal&&"number"!=typeof newVal||($scope.fabric.setLineHeight(newVal),$scope.fabric.render())}),$scope.$watch("fabric.selectedObject.textAlign",function(newVal){"string"==typeof newVal&&($scope.fabric.setTextAlign(newVal),$scope.fabric.render())}),$scope.$watch("fabric.selectedObject.fontFamily",function(newVal){"string"==typeof newVal&&newVal&&($scope.fabric.setFontFamily(newVal),$scope.fabric.render())}),$scope.$watch("fabric.selectedObject.opacity",function(newVal){"string"!=typeof newVal&&"number"!=typeof newVal||($scope.fabric.setOpacity(newVal),$scope.fabric.render())}),$scope.$watch("fabric.selectedObject.fill",function(newVal){"string"==typeof newVal&&($scope.fabric.setFill(newVal),$scope.fabric.render())}),$scope.$watch("fabric.selectedObject.tint",function(newVal){"string"==typeof newVal&&($scope.fabric.setTint(newVal),$scope.fabric.render())})}]}}]),angular.module("common.fabric.constants",[]).service("FabricConstants",[function(){var objectDefaults={rotatingPointOffset:20,padding:0,borderColor:"EEF6FC",cornerColor:"rgba(64, 159, 221, 1)",cornerSize:10,transparentCorners:!1,hasRotatingPoint:!0,centerTransform:!0};return{presetSizes:[{name:"Banner dài (1200 x 160)",height:160,width:1200},{name:"Banner Right (400 x 190)",height:190,width:400},{name:"Banner Slider (500 x 316)",height:316,width:500},{name:"Banner Thumbnail (200 x 200)",height:200,width:200},{name:"Portrait (8.5 x 11)",height:1947,width:1510},{name:"Landscape (11 x 8.5)",width:1947,height:1510},{name:"Business Card (3.5 x 2)",height:368,width:630},{name:"Postcard (6 x 4)",height:718,width:1068},{name:"Content/Builder Product Thumbnail",height:400,width:760},{name:"Badge",height:400,width:400},{name:"Facebook Profile Picture",height:300,width:300},{name:"Facebook Cover Picture",height:315,width:851},{name:"Facebook Photo Post (Landscape)",height:504,width:403},{name:"Facebook Photo Post (Horizontal)",height:1008,width:806},{name:"Facebook Full-Width Photo Post",height:504,width:843}],fonts:[{name:"Roboto"},{name:"Segoe UI"},{name:"Roboto Slab"},{name:"Open Sans"},{name:"Roboto Mono"},{name:"Montserrat"},{name:"Merriweather"},{name:"Raleway"},{name:"Ubuntu"},{name:"Anton"},{name:"Helvetica Neue"},{name:"Arial"}],shapeCategories:[{name:"Popular Shapes",shapes:["arrow6","bubble4","circle1","rectangle1","star1","triangle1"]},{name:"Simple Shapes",shapes:["circle1","heart1","rectangle1","triangle1","star1","star2","star3","square1"]},{name:"Arrows & Pointers",shapes:["arrow1","arrow9","arrow3","arrow6"]},{name:"Bubbles & Balloons",shapes:["bubble5","bubble4"]},{name:"Check Marks",shapes:[]},{name:"Badges",shapes:["badge1","badge2","badge4","badge5","badge6"]}],JSONExportProperties:["height","width","background","objects","originalHeight","originalWidth","originalScaleX","originalScaleY","originalLeft","originalTop","lineHeight","lockMovementX","lockMovementY","lockScalingX","lockScalingY","lockUniScaling","lockRotation","lockObject","id","isTinted","filters"],shapeDefaults:angular.extend({fill:"#0088cc"},objectDefaults),textDefaults:angular.extend({originX:"left",scaleX:1,scaleY:1,fontFamily:"Lato",fontSize:16,fill:"#000",textAlign:"left"},objectDefaults)}}]),angular.module("common.fabric.canvas",["common.fabric.window"]).service("FabricCanvas",["FabricWindow","$rootScope",function(FabricWindow,$rootScope){var self={canvasId:null,element:null,canvas:null};return self.setElement=function(element){self.element=element,$rootScope.$broadcast("canvas:element:selected")},self.createCanvas=function(){return self.canvasId="fabric-canvas-"+Math.floor(1e4*Math.random()),self.element.attr("id",self.canvasId),self.canvas=new FabricWindow.Canvas(self.canvasId),$rootScope.$broadcast("canvas:created"),self.canvas},self.getCanvas=function(){return self.canvas},self.getCanvasId=function(){return self.canvasId},self}]),angular.module("common.fabric",["common.fabric.window","common.fabric.directive","common.fabric.canvas","common.fabric.dirtyStatus"]).factory("Fabric",["FabricWindow","$timeout","$window","FabricCanvas","FabricDirtyStatus",function(FabricWindow,$timeout,$window,FabricCanvas,FabricDirtyStatus){return function(options){var canvas,JSONObject,self=angular.extend({canvasBackgroundColor:"#ffffff",canvasWidth:800,canvasHeight:600,canvasOriginalHeight:600,canvasOriginalWidth:800,maxContinuousRenderLoops:25,continuousRenderTimeDelay:500,editable:!0,JSONExportProperties:[],loading:!1,dirty:!1,initialized:!1,userHasClickedCanvas:!1,downloadMultipler:2,imageDefaults:{},textDefaults:{},shapeDefaults:{},windowDefaults:{transparentCorners:!1,rotatingPointOffset:25,padding:0},canvasDefaults:{selection:!0}},options);function getActiveStyle(styleName,object){return"object"!=typeof(object=object||canvas.getActiveObject())||null===object?"":object.getSelectionStyles&&object.isEditing?object.getSelectionStyles()[styleName]||"":object[styleName]||""}function setActiveStyle(styleName,value,object){if((object=object||canvas.getActiveObject()).setSelectionStyles&&object.isEditing){var style={};style[styleName]=value,object.setSelectionStyles(style)}else object[styleName]=value;self.render()}function getActiveProp(name){var object=canvas.getActiveObject();return"object"==typeof object&&null!==object?object[name]:""}function setActiveProp(name,value){canvas.getActiveObject().set(name,value),self.render()}return self.renderCount=0,self.render=function(){var objects=canvas.getObjects();for(var i in objects)objects[i].setCoords();canvas.calcOffset(),canvas.renderAll(),self.renderCount++},self.setCanvas=function(newCanvas){(canvas=newCanvas).selection=self.canvasDefaults.selection},self.setTextDefaults=function(textDefaults){self.textDefaults=textDefaults},self.setJSONExportProperties=function(JSONExportProperties){self.JSONExportProperties=JSONExportProperties},self.setCanvasBackgroundColor=function(color){self.canvasBackgroundColor=color,canvas.setBackgroundColor(color),self.render()},self.setCanvasWidth=function(width){self.canvasWidth=width,canvas.setWidth(width),self.render()},self.setCanvasHeight=function(height){self.canvasHeight=height,canvas.setHeight(height),self.render()},self.setCanvasSize=function(width,height){self.stopContinuousRendering();var initialCanvasScale=self.canvasScale;self.resetZoom(),self.canvasWidth=width,self.canvasOriginalWidth=width,canvas.originalWidth=width,canvas.setWidth(width),self.canvasHeight=height,self.canvasOriginalHeight=height,canvas.originalHeight=height,canvas.setHeight(height),self.canvasScale=initialCanvasScale,self.render(),self.setZoom(),self.render(),self.setZoom()},self.isLoading=function(){return self.isLoading},self.deactivateAll=function(){canvas.deactivateAll(),self.deselectActiveObject(),self.render()},self.clearCanvas=function(){confirm("Bạn có muốn xóa tất cả?")&&(canvas.clear(),canvas.setBackgroundColor("#ffffff"),self.render())},self.addObjectToCanvas=function(object){object.originalScaleX=object.scaleX,object.originalScaleY=object.scaleY,object.originalLeft=object.left,object.originalTop=object.top,canvas.add(object),self.setObjectZoom(object),canvas.setActiveObject(object),object.bringToFront(),self.center(),self.render()},self.addRect=function(data){var object;if(1==data)object=new fabric.Rect({width:200,height:50,fill:"#9c27b0",top:100,left:100});else if(2==data)object=new fabric.Circle({radius:40,fill:"#03a9f4",top:100,left:100});else if(3==data)object=new fabric.Triangle({top:100,left:100,width:100,height:100,fill:"#4caf50"});else if(4==data)object=new fabric.Line([50,100,300,200],{left:100,top:100,stroke:"#000"});else if(5==data){var points=function(sideCount,radius){for(var sweep=2*Math.PI/sideCount,cx=radius,cy=radius,points=[],i=0;i<sideCount;i++){var x=cx+radius*Math.cos(i*sweep),y=cy+radius*Math.sin(i*sweep);points.push({x:x,y:y})}return points}(6,100);object=new fabric.Polygon(points,{left:100,top:100,fill:"#4fffff",width:100,height:100},!1)}else if(6==data){points=function(spikeCount,outerRadius,innerRadius){Math.PI;for(var cx=outerRadius,cy=outerRadius,sweep=Math.PI/spikeCount,points=[],angle=0,i=0;i<spikeCount;i++){var x=cx+Math.cos(angle)*outerRadius,y=cy+Math.sin(angle)*outerRadius;points.push({x:x,y:y}),angle+=sweep,x=cx+Math.cos(angle)*innerRadius,y=cy+Math.sin(angle)*innerRadius,points.push({x:x,y:y}),angle+=sweep}return points}(5,60,25);object=new fabric.Polygon(points,{left:100,top:100,fill:"#7d7",strokeWidth:0,strokeLineJoin:"bevil"},!1)}object.id=self.createId(),self.addObjectToCanvas(object)},self.addImage=function(imageURL){fabric.Image.fromURL(imageURL,function(object){for(var p in object.id=self.createId(),self.imageOptions)object[p]=self.imageOptions[p];var filter=new fabric.Image.filters.Tint({color:"#FF0000",opacity:0});object.filters.push(filter),object.applyFilters(canvas.renderAll.bind(canvas)),self.addObjectToCanvas(object)},self.imageDefaults)},self.addShape=function(svgURL){fabric.loadSVGFromURL(svgURL,function(objects){var object=fabric.util.groupSVGElements(objects,self.shapeDefaults);for(var p in object.id=self.createId(),self.shapeDefaults)object[p]=self.shapeDefaults[p];if(object.isSameColor&&object.isSameColor()||!object.paths)object.setFill("#0088cc");else if(object.paths)for(var i=0;i<object.paths.length;i++)object.paths[i].setFill("#0088cc");self.addObjectToCanvas(object)})},self.addText=function(str){str=str||"Hello world!\nWeb: https://baonguyenyam.github.io/cv";var object=new FabricWindow.Text(str,self.textDefaults);object.id=self.createId(),self.addObjectToCanvas(object)},self.getText=function(){return getActiveProp("text")},self.setText=function(value){setActiveProp("text",value)},self.getFontSize=function(){return getActiveStyle("fontSize")},self.setFontSize=function(value){setActiveStyle("fontSize",parseInt(value,10)),self.render()},self.getTextAlign=function(){return"string"!=typeof(string=getActiveProp("textAlign"))?"":string.charAt(0).toUpperCase()+string.slice(1);var string},self.setTextAlign=function(value){setActiveProp("textAlign",value.toLowerCase())},self.getFontFamily=function(){var fontFamily=getActiveProp("fontFamily");return fontFamily?fontFamily.toLowerCase():""},self.setFontFamily=function(value){setActiveProp("fontFamily",value.toLowerCase())},self.getLineHeight=function(){return getActiveStyle("lineHeight")},self.setLineHeight=function(value){setActiveStyle("lineHeight",parseFloat(value,10)),self.render()},self.isBold=function(){return"bold"===getActiveStyle("fontWeight")},self.toggleBold=function(){setActiveStyle("fontWeight","bold"===getActiveStyle("fontWeight")?"":"bold"),self.render()},self.isItalic=function(){return"italic"===getActiveStyle("fontStyle")},self.toggleItalic=function(){setActiveStyle("fontStyle","italic"===getActiveStyle("fontStyle")?"":"italic"),self.render()},self.isUnderline=function(){return-1<getActiveStyle("textDecoration").indexOf("underline")},self.toggleUnderline=function(){setActiveStyle("textDecoration",self.isUnderline()?getActiveStyle("textDecoration").replace("underline",""):getActiveStyle("textDecoration")+" underline"),self.render()},self.isLinethrough=function(){return-1<getActiveStyle("textDecoration").indexOf("line-through")},self.toggleLinethrough=function(){setActiveStyle("textDecoration",self.isLinethrough()?getActiveStyle("textDecoration").replace("line-through",""):getActiveStyle("textDecoration")+" line-through"),self.render()},self.getTextAlign=function(){return getActiveProp("textAlign")},self.setTextAlign=function(value){setActiveProp("textAlign",value)},self.getOpacity=function(){return getActiveStyle("opacity")},self.setOpacity=function(value){setActiveStyle("opacity",value)},self.getTintOpacity=function(){return".5"},self.getFlipX=function(){return getActiveProp("flipX")},self.setFlipX=function(value){setActiveProp("flipX",value)},self.toggleFlipX=function(){var value=!self.getFlipX();self.setFlipX(value),self.render()},self.center=function(){var activeObject=canvas.getActiveObject();activeObject&&(activeObject.center(),self.updateActiveObjectOriginals(),self.render())},self.centerH=function(){var activeObject=canvas.getActiveObject();activeObject&&(activeObject.centerH(),self.updateActiveObjectOriginals(),self.render())},self.centerV=function(){var activeObject=canvas.getActiveObject();activeObject&&(activeObject.centerV(),self.updateActiveObjectOriginals(),self.render())},self.sendBackwards=function(){var activeObject=canvas.getActiveObject();activeObject&&(canvas.sendBackwards(activeObject),self.render())},self.sendToBack=function(){var activeObject=canvas.getActiveObject();activeObject&&(canvas.sendToBack(activeObject),self.render())},self.bringForward=function(){var activeObject=canvas.getActiveObject();activeObject&&(canvas.bringForward(activeObject),self.render())},self.bringToFront=function(){var activeObject=canvas.getActiveObject();activeObject&&(canvas.bringToFront(activeObject),self.render())},self.isTinted=function(){return getActiveProp("isTinted")},self.toggleTint=function(){var activeObject=canvas.getActiveObject();activeObject.tintopacit=".5",console.log(activeObject.tintopacity);var filter=new fabric.Image.filters.Tint({color:activeObject.tint,opacity:activeObject.tintopacity}),filterre=new fabric.Image.filters.Tint({color:"#fff",opacity:"0"});activeObject.isTinted=!activeObject.isTinted,activeObject.filters[0]=activeObject.isTinted?filter:filterre,activeObject.applyFilters(canvas.renderAll.bind(canvas))},self.getTint=function(){var object=canvas.getActiveObject();return"object"!=typeof object||null===object?"":void 0!==object.filters&&void 0!==object.filters[0]?object.filters[0].color:void 0},self.setTint=function(tint){if(/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/gi.test(tint)){var activeObject=canvas.getActiveObject();void 0!==activeObject.filters&&void 0!==activeObject.filters[0]&&(activeObject.filters[0].color=tint,activeObject.applyFilters(canvas.renderAll.bind(canvas)))}},self.getFill=function(){return getActiveStyle("fill")},self.setFill=function(value){var object=canvas.getActiveObject();object&&("text"===object.type?setActiveStyle("fill",value):self.setFillPath(object,value))},self.setFillPath=function(object,value){if(object.isSameColor&&object.isSameColor()||!object.paths)object.setFill(value);else if(object.paths)for(var i=0;i<object.paths.length;i++)object.paths[i].setFill(value)},self.getStroke=function(){return getActiveStyle("stroke")},self.setStroke=function(value){setActiveStyle("stroke",value)},self.getStrokeWidth=function(){return getActiveStyle("strokeWidth")},self.setStrokeWidth=function(value){setActiveStyle("strokeWidth",value)},self.resetZoom=function(){self.canvasScale=1,self.setZoom()},self.setZoom=function(){var objects=canvas.getObjects();for(var i in objects)objects[i].originalScaleX=objects[i].originalScaleX?objects[i].originalScaleX:objects[i].scaleX,objects[i].originalScaleY=objects[i].originalScaleY?objects[i].originalScaleY:objects[i].scaleY,objects[i].originalLeft=objects[i].originalLeft?objects[i].originalLeft:objects[i].left,objects[i].originalTop=objects[i].originalTop?objects[i].originalTop:objects[i].top,self.setObjectZoom(objects[i]);self.setCanvasZoom(),self.render()},self.setObjectZoom=function(object){var scaleX=object.originalScaleX,scaleY=object.originalScaleY,left=object.originalLeft,top=object.originalTop,tempScaleX=scaleX*self.canvasScale,tempScaleY=scaleY*self.canvasScale,tempLeft=left*self.canvasScale,tempTop=top*self.canvasScale;object.scaleX=tempScaleX,object.scaleY=tempScaleY,object.left=tempLeft,object.top=tempTop,object.setCoords()},self.setCanvasZoom=function(){var width=self.canvasOriginalWidth,height=self.canvasOriginalHeight,tempWidth=width*self.canvasScale,tempHeight=height*self.canvasScale;canvas.setWidth(tempWidth),canvas.setHeight(tempHeight)},self.updateActiveObjectOriginals=function(){var object=canvas.getActiveObject();object&&(object.originalScaleX=object.scaleX/self.canvasScale,object.originalScaleY=object.scaleY/self.canvasScale,object.originalLeft=object.left/self.canvasScale,object.originalTop=object.top/self.canvasScale)},self.toggleLockActiveObject=function(){var activeObject=canvas.getActiveObject();activeObject&&(activeObject.lockMovementX=!activeObject.lockMovementX,activeObject.lockMovementY=!activeObject.lockMovementY,activeObject.lockScalingX=!activeObject.lockScalingX,activeObject.lockScalingY=!activeObject.lockScalingY,activeObject.lockUniScaling=!activeObject.lockUniScaling,activeObject.lockRotation=!activeObject.lockRotation,activeObject.lockObject=!activeObject.lockObject,self.render())},self.selectActiveObject=function(){var activeObject=canvas.getActiveObject();activeObject&&(self.selectedObject=activeObject,self.selectedObject.text=self.getText(),self.selectedObject.fontSize=self.getFontSize(),self.selectedObject.lineHeight=self.getLineHeight(),self.selectedObject.textAlign=self.getTextAlign(),self.selectedObject.opacity=self.getOpacity(),self.selectedObject.fontFamily=self.getFontFamily(),self.selectedObject.fill=self.getFill(),self.selectedObject.stroke=self.getStroke(),self.selectedObject.strokeWidth=self.getStrokeWidth(),self.selectedObject.tint=self.getTint(),self.selectedObject.tintopacity=self.getTintOpacity())},self.deselectActiveObject=function(){self.selectedObject=!1},self.deleteActiveObject=function(){if(confirm("Bạn có muốn xóa đối tượng này?")){var activeObject=canvas.getActiveObject();canvas.remove(activeObject),self.render()}},self.isLoading=function(){return self.loading},self.setLoading=function(value){self.loading=value},self.setDirty=function(value){FabricDirtyStatus.setDirty(value)},self.isDirty=function(){return FabricDirtyStatus.isDirty()},self.setInitalized=function(value){self.initialized=value},self.isInitalized=function(){return self.initialized},self.getJSON=function(){var initialCanvasScale=self.canvasScale;self.canvasScale=1,self.resetZoom();var json=JSON.stringify(canvas.toJSON(self.JSONExportProperties));return self.canvasScale=initialCanvasScale,self.setZoom(),json},self.loadJSON=function(json){self.setLoading(!0),canvas.loadFromJSON(json,function(){$timeout(function(){self.setLoading(!1),self.editable||self.disableEditing(),self.render()})})},self.getCanvasData=function(){return canvas.toDataURL({width:canvas.getWidth(),height:canvas.getHeight(),multiplier:self.downloadMultipler})},self.getCanvasBlob=function(){var blob=function(b64Data,contentType,sliceSize){contentType=contentType||"",sliceSize=sliceSize||512;for(var byteCharacters=atob(b64Data),byteArrays=[],offset=0;offset<byteCharacters.length;offset+=sliceSize){for(var slice=byteCharacters.slice(offset,offset+sliceSize),byteNumbers=new Array(slice.length),i=0;i<slice.length;i++)byteNumbers[i]=slice.charCodeAt(i);var byteArray=new Uint8Array(byteNumbers);byteArrays.push(byteArray)}return new Blob(byteArrays,{type:contentType})}(self.getCanvasData().replace("data:image/png;base64,",""),"image/png");return URL.createObjectURL(blob)},self.download=function(name){self.deactivateAll();var initialCanvasScale=self.canvasScale;self.resetZoom();var link=document.createElement("a"),filename=name+".png";link.download=filename,link.href=self.getCanvasBlob(),link.click(),self.canvasScale=initialCanvasScale,self.setZoom()},self.continuousRenderCounter=0,self.continuousRenderHandle,self.stopContinuousRendering=function(){$timeout.cancel(self.continuousRenderHandle),self.continuousRenderCounter=self.maxContinuousRenderLoops},self.startContinuousRendering=function(){self.continuousRenderCounter=0,self.continuousRender()},self.continuousRender=function(){self.userHasClickedCanvas||self.continuousRenderCounter>self.maxContinuousRenderLoops||(self.continuousRenderHandle=$timeout(function(){self.setZoom(),self.render(),self.continuousRenderCounter++,self.continuousRender()},self.continuousRenderTimeDelay))},self.setUserHasClickedCanvas=function(value){self.userHasClickedCanvas=value},self.createId=function(){return Math.floor(1e4*Math.random())},self.disableEditing=function(){canvas.selection=!1,canvas.forEachObject(function(object){object.selectable=!1})},self.enableEditing=function(){canvas.selection=!0,canvas.forEachObject(function(object){object.selectable=!0})},self.setCanvasDefaults=function(){canvas.selection=self.canvasDefaults.selection},self.setWindowDefaults=function(){FabricWindow.Object.prototype.transparentCorners=self.windowDefaults.transparentCorners,FabricWindow.Object.prototype.rotatingPointOffset=self.windowDefaults.rotatingPointOffset,FabricWindow.Object.prototype.padding=self.windowDefaults.padding},self.startCanvasListeners=function(){canvas.on("object:selected",function(){self.stopContinuousRendering(),$timeout(function(){self.selectActiveObject(),self.setDirty(!0)})}),canvas.on("selection:created",function(){self.stopContinuousRendering()}),canvas.on("selection:cleared",function(){$timeout(function(){self.deselectActiveObject()})}),canvas.on("after:render",function(){canvas.calcOffset()}),canvas.on("object:modified",function(){self.stopContinuousRendering(),$timeout(function(){self.updateActiveObjectOriginals(),self.setDirty(!0)})})},self.getFreeDrawingMode=function(){return canvas.isDrawingMode},self.setFreeDrawingMode=function(value){canvas.isDrawingMode=!!value},self.freeDrawingMode="Pencil",self.getDrawingMode=function(){return self.freeDrawingMode},self.setDrawingMode=function(type){self.freeDrawingMode=type,canvas.freeDrawingBrush="hline"===type?self.vLinePatternBrush:"vline"===type?self.hLinePatternBrush:"square"===type?self.squarePatternBrush:"diamond"===type?self.diamondPatternBrush:"texture"===type?self.texturePatternBrush:new fabric[type+"Brush"](canvas)},self.getDrawingLineWidth=function(){if(canvas.freeDrawingBrush)return canvas.freeDrawingBrush.width},self.setDrawingLineWidth=function(value){canvas.freeDrawingBrush&&(canvas.freeDrawingBrush.width=parseInt(value,10)||1)},self.getDrawingLineColor=function(){if(canvas.freeDrawingBrush)return canvas.freeDrawingBrush.color},self.setDrawingLineColor=function(value){canvas.freeDrawingBrush&&(canvas.freeDrawingBrush.color=value)},self.getDrawingLineShadowWidth=function(){return canvas.freeDrawingBrush&&canvas.freeDrawingBrush.shadow?canvas.freeDrawingBrush.shadow.blur||1:0},self.setDrawingLineShadowWidth=function(value){if(canvas.freeDrawingBrush){var blur=parseInt(value,10)||1;canvas.freeDrawingBrush.shadow=0<blur?new fabric.Shadow({blur:blur,offsetX:10,offsetY:10}):null}},self.init=function(){canvas=FabricCanvas.getCanvas(),self.canvasId=FabricCanvas.getCanvasId(),canvas.clear(),JSONObject=angular.fromJson(self.json),self.loadJSON(self.json),JSONObject=JSONObject||{},self.canvasScale=1,JSONObject.background=JSONObject.background||"#ffffff",self.setCanvasBackgroundColor(JSONObject.background),JSONObject.width=JSONObject.width||800,self.canvasOriginalWidth=JSONObject.width,JSONObject.height=JSONObject.height||600,self.canvasOriginalHeight=JSONObject.height,self.setCanvasSize(self.canvasOriginalWidth,self.canvasOriginalHeight),self.render(),self.setDirty(!1),self.setInitalized(!0),self.setCanvasDefaults(),self.setWindowDefaults(),self.startCanvasListeners(),self.startContinuousRendering(),FabricDirtyStatus.startListening()},self.init(),self}}]);